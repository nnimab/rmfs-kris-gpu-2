# 3.4.3 狀態空間設計

狀態空間的定義是強化學習成功的基石。它必須為智能體提供足夠且有意義的資訊以做出有效決策，同時又要避免因維度過高而導致的「維度災難」(Curse of Dimensionality)。在本研究的 RMFS 交通控制問題中，任一交叉路口在決策時刻 $t$ 的狀態 $s_t$ 被定義為一個能全面反映其局部交通狀況、並兼顧周邊及下游路口潛在影響的特徵向量。

具體而言，$s_t$ 是一個 **17 維的連續向量**，其構成如下：

**1. 局部狀態 (Local State) - 8 維**: 描述控制器自身所在交叉路口的即時交通資訊。
    *   **水平方向 (Horizontal)**:
        *   $s_t[0]$: **佇列長度 (Queue Length)** - 水平幹道上等待通過路口的機器人數量。
        *   $s_t[1]$: **首車等待時間 (First Vehicle Waiting Time)** - 若佇列非空，此為佇列中第一個機器人已等待的時間；否則為 0。
        *   $s_t[2]$: **平均等待時間 (Average Waiting Time)** - 水平方向所有等待機器人的平均等待時間。
        *   $s_t[3]$: **下游飽和度 (Downstream Saturation)** - 水平方向下一個路口的佇列長度，用以預測潛在的回堵 (spillback) 風險。
    *   **垂直方向 (Vertical)**:
        *   $s_t[4]$ - $s_t[7]$: 對應垂直幹道的上述四個特徵。

**2. 鄰居狀態 (Neighbor State) - 8 維**: 描述與當前路口直接相連的四個鄰居路口的關鍵資訊，幫助智能體理解更廣泛的交通態勢。
    *   **上、下、左、右四個鄰居**各包含 2 維資訊：
        *   $s_t[8], s_t[9]$: **上方鄰居** - 垂直佇列長度、水平佇列長度。
        *   $s_t[10], s_t[11]$: **下方鄰居** - 垂直佇列長度、水平佇列長度。
        *   $s_t[12], s_t[13]$: **左側鄰居** - 垂直佇列長度、水平佇列長度。
        *   $s_t[14], s_t[15]$: **右側鄰居** - 垂直佇列長度、水平佇列長度。

**3. 全局狀態 (Global State) - 1 維**: 引入一個宏觀指標，幫助智能體將局部決策與整體系統目標對齊。
    *   $s_t[16]$: **揀貨站平均佇列 (Average Picking Station Queue)** - 所有揀貨站入口處的平均排隊長度。這是一個關鍵的系統級指標，因為揀貨站是整個物料流動的最終瓶頸。

### 狀態歸一化

由於上述 17 個特徵的物理單位和數值範圍各不相同（例如，計數、時間、比率），若直接輸入神經網路，不同尺度的特徵會對梯度產生不同程度的影響，進而導致訓練過程不穩定。因此，在將狀態向量 $s_t$ 饋入 DRL 模型之前，本研究採用了一種**自適應歸一化 (Adaptive Normalization)** 技術。該技術在訓練過程中會動態追蹤每個狀態特徵的運行均值和標準差，並依此將特徵值標準化為均值接近 0、標準差接近 1 的分佈，從而確保模型訓練的穩定性與效率。 