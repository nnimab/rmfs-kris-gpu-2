# V5.0 參數調整建議

## 問題分析
觀察到的 -10.14 適應度表明系統配置存在問題：
1. 在短時間內（400 ticks）無法完成訂單
2. 溢出懲罰累積過快，超過了任何可能的正面獎勵

## 已實施的參數調整

### 1. 溢出懲罰參數
- **spillback_penalty_per_tick**: 0.01 → 0.001（降低10倍）
- **spillback_queue_threshold**: 5.0 → 10.0（提高到10）

### 理由
- 原始懲罰太嚴厲，即使輕微擁堵也會產生巨大負值
- 閾值太低（5），正常運作時就可能觸發懲罰
- 新參數更寬容，允許系統有學習和適應的空間

## 建議的訓練參數

### 對於測試和調試：
```bash
python train.py --agent nerl --reward_mode global --generations 5 --population 10 --eval_ticks 2000
```

### 對於正式訓練：
```bash
python train.py --agent nerl --reward_mode global --generations 20 --population 20 --eval_ticks 4000
```

### 關鍵參數說明：
- **eval_ticks**: 至少 2000，建議 4000（給系統足夠時間完成訂單）
- **population**: 至少 10（確保有足夠的多樣性）
- **generations**: 至少 5 進行初步評估

## 預期結果

調整後的系統應該：
1. 產生正的適應度值（當完成訂單時）
2. 適應度範圍大約在 0 到 50 之間
3. 隨著世代演進，適應度逐漸提高

## 監控指標

訓練時請注意：
1. **完成訂單數**：每個評估期間至少應完成 1-2 個訂單
2. **平均隊列長度**：應該保持在 10 以下
3. **適應度趨勢**：應該隨世代增加而改善

## 進一步優化

如果問題持續：
1. 考慮完全移除溢出懲罰，先讓系統學會基本的訂單完成
2. 增加 completion_bonus（如改為 200）
3. 檢查初始訂單生成速率是否過高