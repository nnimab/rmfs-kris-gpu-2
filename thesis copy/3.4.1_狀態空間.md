# 3.4.1 狀態空間 (State Space)

狀態空間的設計是強化學習成功的關鍵，它必須為智能體提供足夠的、有意義的資訊，以做出有效決策，同時又要避免維度災難。在本研究的 RMFS 交通控制問題中，狀態被定義為一個能全面反映交叉路口局部交通狀況、並兼顧下游路口潛在影響的特徵向量。

每個交叉路口控制器的狀態 `s` 是一個 **17 維的連續向量**，其構成如下：

1.  **局部狀態 (Local State) - 8 維**: 描述控制器所在交叉路口自身的即時交通資訊。
    *   **水平方向 (Horizontal)**:
        *   `[0]` **佇列長度 (Queue Length)**: 水平幹道上等待通過路口的機器人數量。
        *   `[1]` **首車等待時間 (First Vehicle Waiting Time)**: 如果佇列非空，此為佇列中第一個機器人已等待的時間；否則為 0。
        *   `[2]` **平均等待時間 (Average Waiting Time)**: 水平方向所有等待機器人的平均等待時間。
        *   `[3]` **下游飽和度 (Downstream Saturation)**: 水平方向下一個路口的佇列長度，用以預測潛在的回堵 (spillback) 風險。
    *   **垂直方向 (Vertical)**:
        *   `[4]`-`[7]` 對應垂直幹道的上述四個特徵。

2.  **鄰居狀態 (Neighbor State) - 8 維**: 描述與當前路口直接相連的四個鄰居路口的關鍵資訊，幫助智能體理解更廣泛的交通態勢。
    *   **上、下、左、右四個鄰居**各包含 2 維資訊：
        *   `[8, 9]` **上方鄰居**: 垂直佇列長度、水平佇列長度。
        *   `[10, 11]` **下方鄰居**: 垂直佇列長度、水平佇列長度。
        *   `[12, 13]` **左側鄰居**: 垂直佇列長度、水平佇列長度。
        *   `[14, 15]` **右側鄰居**: 垂直佇列長度、水平佇列長度。

3.  **全局狀態 (Global State) - 1 維**: 引入一個宏觀指標，幫助智能體將局部決策與整體系統目標對齊。
    *   `[16]` **揀貨站平均佇列 (Average Picking Station Queue)**: 所有揀貨站入口處的平均排隊長度。這是一個關鍵指標，因為揀貨站是整個系統的最終瓶頸。

### 狀態歸一化

由於上述 17 個特徵的單位和數值範圍各不相同（例如，計數、時間、飽和度），直接輸入神經網路會導致訓練不穩定。因此，在將狀態向量饋入 DRL 模型之前，本研究採用了一種**自適應歸一化 (Adaptive Normalization)** 技術。該技術會動態追蹤每個狀態特徵的運行均值和標準差，並將其標準化為均值為 0、標準差為 1 的分佈，確保了模型訓練的穩定性和效率。 