# 代辦事項1.5：專案總體理解與控制器深度審查

## 任務目標

由於距離專案初期開發已有數月，為確保開發團隊（包括人類與AI）對現有程式碼有全面且深入的理解，本任務旨在系統性地審查整個專案，特別是四個核心交通控制器的實現邏輯。

最終產出應為一份清晰的分析報告，內容包括：
1.  **確認實現**：驗證每個控制器是否已按預期邏輯正確實現，而不僅僅是佔位或存在錯誤邏輯。
2.  **解釋邏輯**：用清晰的語言解釋每個控制器的工作原理、決策依據。
3.  **識別改進點**：找出設計上或實現中可以優化的地方，並明確記錄。
4. **確認及建檔**: 與用戶確認及討論完成後記得去/審查報告去創建對應的內容.md檔案寫進去

## 審查流程與規則

AI 助理需遵循以下步驟，逐一完成對每個控制器的審查，並以互動方式向使用者報告。

---

### 第一部分：四大控制器深度審查

針對以下四個控制器，逐一執行下列分析：
- **時間基控制器 (Time-Based Controller)**
- **隊列基控制器 (Queue-Based Controller)**
- **DQN 控制器 (DQN Controller)**
- **NERL 控制器 (NERL Controller)**

#### **分析步驟 (對每個控制器重複執行)**：

1.  **定位與初步分析**:
    - 找到該控制器的主要原始碼檔案。
    - 閱讀檔案頂部的註釋和類別說明，建立初步理解。
    - 查閱 `CHANGELOG.md` 中與此控制器相關的所有版本紀錄，了解其發展歷程與設計變更。

2.  **核心邏輯拆解與解釋**:
    - **決策依據是什麼？**
      - **(Time-Based)**：是固定的時間週期嗎？時間長度如何設定？
      - **(Queue-Based)**：如何定義「隊列」？如何計算「優先級」？`bias_factor` 的作用是什麼？
      - **(DQN/NERL)**：**狀態空間 (State)** 包含哪些資訊？（它能「看見」什麼？）
      - **(DQN/NERL)**：**動作空間 (Action)** 有哪些選擇？（它能「做」什麼？）
      - **(DQN/NERL)**：**獎勵/適應度 (Reward/Fitness)** 如何計算？（它如何判斷自己做得好不好？）
    - **演算法流程是怎樣的？**
      - `get_direction` 函式是主要的決策點，解釋其完整的判斷流程。
      - 對於 AI 控制器 (DQN/NERL)，解釋其訓練機制 (`train` / `_evolve` 函式) 是如何被觸發和執行的。

3.  **正確性驗證與問題識別**:
    - **程式碼是否符合日誌？** 將目前程式碼的實現與 `CHANGELOG.md` 的描述進行比對，確認是否一致。
    - **是否存在邏輯缺陷？** 批判性地思考當前邏輯可能導致的問題。
      - *範例*：「隊列基控制器的 `bias_factor` 是一個硬編碼的偏好因子，這在高流量下是否可能導致垂直方向的車流長時間等待（飢餓問題）？」
      - *範例*：「DQN 的獎勵函式同時考慮了等待時間和通行效率，這兩者之間是否存在衝突，導致模型訓練目標不明確？」
      - *範リ*：「NERL 的狀態空間只考慮自身路口，是否是造成『卍』字鎖死問題的根本原因？」

4.  **提出改進建議**:
    - 基於上述分析，若發現任何可以改進之處，需明確記錄下來。
    - **格式**: 「**【潛在改進點】** 在 `XXX控制器` 中，[描述問題或可優化之處]。**建議**：[提出具體的改進方案]。**後續行動**：此項建議應在未來創建為一個新的代辦事項來獨立追蹤和實現。」

---

### 第二部分：提報與互動

- AI 應針對**每一個控制器**，在完成上述所有分析步驟後，向使用者提交一份簡潔的分析報告。
- 報告應包含「核心邏輯解釋」、「正確性驗證」和「潛在改進點」三個部分。
- 在使用者確認對一個控制器的分析報告滿意後，再繼續分析下一個控制器。

這個代辦事項的主要目的是**理解和解釋**，而非立即進行修改。所有修改性質的工作，都應在本次審查結束後，作為新的代辦事項來處理。

---

### 第三部分：控制器效能評估指標審查

**任務目標**: 審查並記錄專案中用於評估控制器效能的關鍵績效指標 (KPIs)，確保其計算方式正確、有意義，並為論文寫作提供素材。

**審查步驟**:

1.  **定位指標計算邏輯**:
    - 審查 `evaluation/performance_report_generator.py` 及其他有相關的檔案。
    - 列出所有被計算的效能指標 (KPIs)。

2.  **解釋每個指標**:
    - 對於每一個指標，需解釋以下三點：
      - **指標名稱**: 例如，「總能量消耗」。
      - **用途與意義**: 這個指標用來衡量什麼？為什麼它對評估控制器效能很重要？
      - **計算公式**: 它的具體計算方式是什麼？（例如：基於機器人移動距離和啟停次數的加權總和）。

3.  **評估與改進**:
    - **現有指標是否足夠？** 思考當前的 KPI 組合是否能全面地評估一個控制器的優劣？
    - **【潛在改進點】**: 思考並提出未來可以新增的效能指標。
      - **格式**: 「**【新增指標建議】** 目前缺少對 [某個方面，如公平性] 的評估。**建議**：新增 [指標名稱，如等待時間標準差]，其計算方式為 [簡述計算方法]，用以衡量 [指標的意義]。**後續行動**：此項建議應在未來創建為新的代辦事項。」
      - *範例*：「目前缺少對『公平性』的評估，例如，某個方向的車輛平均等待時間是否遠高於另一方向。未來可考慮新增『等待時間標準差』作為衡量交通公平性的指標。」 