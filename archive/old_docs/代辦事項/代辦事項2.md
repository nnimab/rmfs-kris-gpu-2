# 2025-06-17 代辦事項

## 主要任務

根據我們與 AI 助手的討論，今日的核心任務是解決 NERL 控制器在多代理人環境下的協調失敗問題，特別是「卍」字鎖死現象。

### 2. 方案一：加強感知 (擴展狀態空間)

- **任務描述**: 正式實施之前討論的方案一，讓十字路口 Agent (NERL Controller) 能夠感知其周圍環境。
- **具體步驟**:
  1. **修改 `nerl_controller.py` 中的 `get_state` 函式**:
     - 呼叫 `warehouse.intersection_manager.getConnectedIntersections(intersection)` 獲取相鄰路口列表。
     - 為每個方向的相鄰路口（例如，上、下、左、右）提取關鍵狀態資訊（如：當前允許方向 `allowed_direction`、排隊車輛數 `len(robots)`)。
     - 將這些新資訊正規化後，附加到原有的 `state` 向量中。
  2. **更新模型參數**:
     - 在 `nerl_controller.py` 的 `__init__` 中，根據新增的狀態維度，增加 `state_size` 的值。
  3. **重新訓練**:
     - 由於模型結構已改變，所有舊模型將失效。需要規劃並執行新的模型訓練流程。

### 3. 方案二：引入溝通機制 (綠波)

- **任務描述**: 在方案一的基礎上，考慮實作或完善方案二，建立路口間的主動溝通機制。
- **目標**: 讓路口之間可以主動傳遞「車流即將到達」的資訊，實現更智能的交通協調。
- **考量點**:
  - 訊息格式的設計。
  - 全局訊息管理器的實作。
  - Agent 如何根據收到的訊息調整自身決策邏輯。

---
**備註**: 優先完成任務 1 和 2。任務 3 可以在任務 2 完成並驗證效果後，作為進一步的優化來考慮。 