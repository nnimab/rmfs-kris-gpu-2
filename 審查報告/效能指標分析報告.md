### 控制器效能評估指標審查報告

這份報告依據 `代辦事項1.5` 的要求，對專案中使用的效能指標進行了系統性審查。

#### 第一部分：現有指標解釋

以下是從 `evaluation/performance_report_generator.py` 中分析得出的關鍵績效指標 (KPIs) 及其說明：

1.  **總能量消耗 (Total Energy Consumption)**
    *   **用途與意義**: 衡量整個系統的能源效率。較低的能耗代表著更優化的路徑規劃與交通控制。
    *   **計算公式**: `self.warehouse.total_energy`，即模擬期間累計的總能量消耗。

2.  **平均訂單處理時間 (Average Order Processing Time)**
    *   **用途與意義**: 評估訂單完成的效率，是衡量系統處理能力的核心指標。
    *   **計算公式**: `(order.order_complete_time - order.process_start_time)` 對所有已完成訂單的平均值。

3.  **已完成訂單數量 (Completed Orders Count)**
    *   **用途與意義**: 衡量系統在固定時間內的總產出量 (Throughput)。
    *   **計算公式**: 累計已完成 (`order_complete_time > 0`) 的訂單總數。

4.  **完成全部訂單所需的總時間 (Total Completion Time)**
    *   **用途與意義**: 衡量完成所有任務所需的時間，反映總體效率。
    *   **計算公式**: 已完成訂單中的最大完成時間 `max(order.order_complete_time)`。

5.  **機器人平均利用率 (Average Robot Utilization)**
    *   **用途與意義**: 衡量機器人資源是否被充分利用。
    *   **計算公式**: `(總機器人活動時間 / (機器人總數 * 總模擬時間))`，其中活動時間為機器人非 `idle` 狀態的總時長。

6.  **總停止-啟動次數 (Total Stop-and-Go)**
    *   **用途與意義**: 反映交通的流暢性。頻繁的啟停意味著交通擁堵或協調不佳。
    *   **計算公式**: `self.warehouse.stop_and_go`，一個在倉儲中累計的計數器。

7.  **平均交叉口等待時間 (Average Intersection Waiting Time)**
    *   **用途與意義**: 衡量交叉口的擁堵情況和交通瓶頸。
    *   **計算公式**: `intersection.getAverageWaitingTime()` 對所有交叉口的平均值。

8.  **平均/最高交叉口流量 (Average/Max Intersection Traffic)**
    *   **用途與意義**: 衡量交叉口的使用頻繁程度，識別關鍵交通節點。
    *   **計算公式**: `intersection.getAverageTrafficRate(current_tick)` 的平均值與最大值。

9.  **平均/最高交叉口擁堵程度 (Average/Max Intersection Congestion)**
    *   **用途與意義**: 提供交叉口即時的擁堵快照。
    *   **計算公式**: `intersection.robotCount()` 在所有交叉口中的平均值與最大值。

10. **NERL 適應度 (NERL Fitness)**
    *   **用途與意義**: 專為 NERL 控制器設計，評估其演化過程中的學習表現。
    *   **計算公式**: 由 NERL 控制器內部的適應度函數計算得出，報告生成器僅負責讀取歷史數據並繪圖。

---

#### 第二部分：評估與改進建議

現有的 KPI 組合已相當全面，但仍有擴充空間：

1.  **【潛在改進點】缺乏對「公平性」的評估。**
    *   **問題**: 「平均等待時間」可能會掩蓋局部嚴重的延遲問題，即某些機器人等待時間過長。
    *   **建議**: 新增「**等待時間標準差**」或「**等待時間 P95 分位數**」，用以衡量等待時間的離散程度和極端情況，更準確地反映系統的公平性。
    *   **後續行動**: 此項建議應創建為新的代辦事項進行追蹤。

2.  **【潛在改進點】缺乏「任務完成率」的相對指標。**
    *   **問題**: 在比較不同總訂單數的實驗時，「已完成訂單數量」這個絕對值不便於公平比較。
    *   **建議**: 新增「**訂單完成率 (Order Completion Rate)**」，計算公式為 `(已完成訂單數 / 總生成訂單數) * 100%`。
    *   **後續行動**: 此項建議應創建為新的代辦事項進行追蹤。

3.  **【潛在改進點】缺乏對路徑「冗餘度」的量化。**
    *   **問題**: 無法直接衡量機器人因繞路、避讓而多行駛的距離。
    *   **建議**: 新增「**平均路徑冗餘度**」，計算公式為 `(實際行駛距離 / 最短理論距離)` 的平均比率。這能有效量化路徑規劃的效率。
    *   **後續行動**: 這是一個較複雜的指標，可作為長期改進目標。 